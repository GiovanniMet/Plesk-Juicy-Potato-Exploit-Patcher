#cs ----------------------------------------------------------------------------

 AutoIt Version: 3.3.14.5
 Author:         Giovanni Metitieri

 Script Function:
	Template AutoIt script.

#ce ----------------------------------------------------------------------------

; Script Start - Add your code below here
#RequireAdmin
#include <ButtonConstants.au3>
#include <EditConstants.au3>
#include <GUIConstantsEx.au3>
#include <WindowsConstants.au3>
#Region ### START Koda GUI section ### Form=
$Form1 = GUICreate("Juicy Potato Patcher", 615, 239, 192, 124)
$Button1 = GUICtrlCreateButton("Patch!", 24, 136, 571, 41)
$Group1 = GUICtrlCreateGroup("Juicy Potato", 8, 8, 593, 177)
$Status = GUICtrlCreateEdit("", 24, 32, 569, 97)
GUICtrlSetData(-1, "Status" & @CRLF)
$Verifica = GUICtrlCreateButton("Verifica!", 24, 184, 569, 41)
GUICtrlCreateGroup("", -99, -99, 1, 1)
GUISetState(@SW_SHOW)
#EndRegion ### END Koda GUI section ###

Check()

While 1
	$nMsg = GUIGetMsg()
	Switch $nMsg
		Case $GUI_EVENT_CLOSE
			Exit
		 Case $Button1
			Patch()
		 Case $Verifica
			Check()
	EndSwitch
WEnd

Func Patch()
   RegWrite("HKEY_LOCAL_MACHINE\Software\Microsoft\OLE", "EnableDCOM", "REG_SZ", "N")
EndFunc

Func Check()
   $dcom = RegRead ( "HKEY_LOCAL_MACHINE\Software\Microsoft\OLE", "EnableDCOM" )
   If (StringCompare($dcom,"Y") == 0)Then
	  $msg = "Applica la Patch e riavvia il server" & @CRLF
	  GUICtrlSetData($Status, $msg, 1)
   Else
	  $msg = "Patch Presente, riavvia il server" & @CRLF
	  GUICtrlSetData($Status, $msg, 1)
   EndIf
EndFunc